<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –æ—Ç–∫—Ä—ã—Ç–∫–∞ 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  overflow:hidden;
  font-family:'Segoe UI',system-ui,sans-serif;
  background:#000;
  color:#fff;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  overscroll-behavior: none;
  -webkit-text-size-adjust: 100%;
  -moz-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

/* –§–æ–Ω —Å –∫–∞—Ä—Ç–∏–Ω–∫–æ–π */
body{
  background:
    linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.95)),
    url("bg.jpg") center/cover no-repeat fixed;
  position: fixed;
  width: 100%;
  height: 100%;
}

#snow{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index:2;
  opacity:0.8;
}
#tg{
  position:fixed;
  left:15px;
  bottom:15px;
  font-size:12px;
  opacity:.3;
  z-index:5;
  font-family:monospace;
}

/* –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω */
#start{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:30px;
  z-index:100;
  background:rgba(0,0,0,0.95);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
  opacity:0;
  animation: gentleAppear 1s ease forwards;
  padding:20px;
  box-sizing:border-box;
}
@keyframes gentleAppear {
  to { opacity:1; }
}

#browserNote{
  max-width:400px;
  width:90%;
  padding:20px;
  font-size:14px;
  line-height:1.6;
  text-align:center;
  background:rgba(0,20,40,0.8);
  border-radius:20px;
  border:1px solid rgba(100,200,255,0.2);
  box-shadow:0 10px 30px rgba(0,100,255,0.3);
  transform:translateY(20px);
  animation: noteAppear 1s 0.5s ease forwards;
  box-sizing:border-box;
}
@keyframes noteAppear {
  to { transform:translateY(0); }
}

#startBtn{
  padding:16px 32px;
  font-size:20px;
  font-weight:600;
  border:none;
  border-radius:50px;
  background:linear-gradient(135deg,#00e0ff,#0088ff,#a100ff);
  background-size:200% 200%;
  color:#fff;
  cursor:pointer;
  position:relative;
  overflow:hidden;
  box-shadow:0 0 30px rgba(0,234,255,0.5);
  transition:all 0.3s ease;
  animation:
    gradientFlow 3s ease infinite,
    buttonAppear 1s 0.7s ease forwards;
  opacity:0;
  transform:scale(0.95);
  min-width:200px;
  -webkit-appearance:none;
  touch-action:manipulation;
}
@keyframes gradientFlow {
  0%, 100% { background-position:0% 50%; }
  50% { background-position:100% 50%; }
}
@keyframes buttonAppear {
  to { opacity:1; transform:scale(1); }
}
#startBtn:active{
  transform:scale(0.98);
}
#startBtn::before{
  content:'';
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);
  transition:0.5s;
}
#startBtn:active::before{
  left:100%;
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º —ç–∫—Ä–∞–Ω–µ */
#preloadProgress {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 400px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 101;
}

.progress-bar {
  width: 100%;
  height: 6px;
  background: rgba(255,255,255,0.1);
  border-radius: 3px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #00e0ff, #0088ff);
  border-radius: 3px;
  transition: width 0.3s ease;
}

#preloadStatus {
  font-size: 14px;
  color: rgba(255,255,255,0.8);
  text-align: center;
}

/* –°—Ü–µ–Ω–∞ —Å –æ—Ç–∫—Ä—ã—Ç–∫–æ–π */
.scene{
  width:100%;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  perspective:1200px;
  opacity:0;
  transform:scale(0.95);
  transition:all 1.2s cubic-bezier(0.34,1.56,0.64,1);
  padding:20px;
  box-sizing:border-box;
}
.scene.active {
  opacity:1;
  transform:scale(1);
}

.card{
  width:min(95vw, 800px);
  height:min(65vh, 450px);
  position:relative;
  transform-style:preserve-3d;
  transition:transform 1.5s cubic-bezier(0.4,0.2,0.2,1);
}

.side{
  position:absolute;
  width:100%;
  height:100%;
  border-radius:20px;
  backface-visibility:hidden;
  overflow:hidden;
  background:linear-gradient(145deg,rgba(0,30,70,0.95),rgba(0,15,40,0.98));
  border:1px solid rgba(100,200,255,0.3);
  box-shadow:0 20px 50px rgba(0,100,255,0.4),
             inset 0 1px 0 rgba(255,255,255,0.1);
  display:flex;
  flex-direction:column;
  padding:25px;
  box-sizing:border-box;
}
.back{
  transform:rotateY(180deg);
}

/* –ì–∏—Ä–ª—è–Ω–¥–∞ */
.garland-wrapper {
  position: absolute;
  top: -15px;
  left: 0;
  width: 100%;
  height: 30px;
  display: flex;
  justify-content: center;
  z-index: 10;
}

.garland{
  display:flex;
  justify-content:space-between;
  width:calc(100% - 40px);
  padding:8px 15px;
  background:rgba(0,0,0,0.6);
  border-radius:15px;
  border:1px solid rgba(255,255,255,0.1);
  position:relative;
}
.garland::before {
  content:'';
  position:absolute;
  top:50%;
  left:15px;
  right:15px;
  height:2px;
  background:rgba(255,255,255,0.1);
  transform:translateY(-50%);
  z-index:1;
}
.garland span{
  width:10px;
  height:10px;
  border-radius:50%;
  background:hsl(calc(var(--i) * 20), 100%, 65%);
  box-shadow:0 0 8px currentColor;
  animation:blink 2s infinite alternate calc(var(--i) * 0.1s);
  position:relative;
  z-index:2;
}
.garland span::before{
  content:'';
  position:absolute;
  top:-2px;
  left:-2px;
  right:-2px;
  bottom:-2px;
  border-radius:50%;
  background:currentColor;
  filter:blur(4px);
  opacity:0.3;
}
@keyframes blink{
  0%,100%{opacity:1; transform:scale(1);}
  50%{opacity:0.5; transform:scale(0.9);}
}

/* –¢–µ–∫—Å—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ */
.card-content{
  margin-top:30px;
  flex:1;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
}
.card-content h1{
  margin:0 0 15px;
  font-size:clamp(28px, 6vw, 40px);
  background:linear-gradient(45deg,#fff,#a0e0ff,#ffa0ff);
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
  font-weight:800;
  text-shadow:0 0 15px rgba(160,224,255,0.3);
}
.card-content p{
  margin:0;
  font-size:clamp(16px, 3.5vw, 20px);
  line-height:1.6;
  color:rgba(255,255,255,0.95);
  font-weight:300;
  max-width:90%;
}

/* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –∏ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ */
#dark{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:#000;
  opacity:0;
  transition:opacity 2.5s cubic-bezier(0.4,0,0.2,1);
  z-index:20;
  pointer-events:none;
}

#finalText{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  text-align:center;
  font-size:clamp(28px, 6vw, 50px);
  font-weight:900;
  opacity:0;
  transition:opacity 2s ease;
  z-index:22;
  background:linear-gradient(45deg,#fff,#00eaff,#ff00ff);
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
  padding:20px;
  pointer-events:none;
  text-shadow:0 0 20px rgba(0,234,255,0.5);
  letter-spacing:1px;
  box-sizing:border-box;
}

/* –í—Å–ø—ã—à–∫–∞ */
#whiteFlash{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:#fff;
  opacity:0;
  z-index:30;
  pointer-events:none;
  transition:opacity 3s ease-out;
}

/* –í–∏–¥–µ–æ */
#cat{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  object-fit:cover;
  opacity:0;
  z-index:35;
  pointer-events:none;
  transition:opacity 1.5s ease;
  transform:translateZ(0);
  -webkit-transform:translateZ(0);
}
#cat.playing {
  opacity:1;
}

/* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –≤–∏–¥–µ–æ */
#videoFade{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:#000;
  opacity:0;
  z-index:36;
  pointer-events:none;
  transition:opacity 10s linear;
}

/* –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω */
#finalScreen{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:#000;
  opacity:0;
  z-index:50;
  overflow:hidden;
  transition:opacity 1.5s ease;
}

/* –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ —á–µ—Ä–Ω–æ–º —Ñ–æ–Ω–µ */
.final-effects{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  opacity:0.1;
}
.final-effects::before{
  content:'';
  position:absolute;
  top:20%;
  left:10%;
  width:200px;
  height:200px;
  background:radial-gradient(circle,rgba(0,100,255,0.4),transparent);
  border-radius:50%;
  filter:blur(30px);
  animation:float 15s ease-in-out infinite;
}
.final-effects::after{
  content:'';
  position:absolute;
  bottom:20%;
  right:10%;
  width:150px;
  height:150px;
  background:radial-gradient(circle,rgba(100,0,255,0.3),transparent);
  border-radius:50%;
  filter:blur(30px);
  animation:float 20s ease-in-out infinite reverse;
}
@keyframes float{
  0%,100%{ transform:translateY(0) scale(1); }
  50%{ transform:translateY(-15px) scale(1.1); }
}

/* QR –∫–æ–¥ */
#qrContainer{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  display:flex;
  flex-direction:column;
  align-items:center;
  opacity:0;
  transition:all 1s cubic-bezier(0.34,1.56,0.64,1);
  width:90%;
  max-width:400px;
  padding:20px;
  box-sizing:border-box;
}

#qr{
  width:200px;
  height:200px;
  margin-bottom:25px;
  transform:translateY(-50px) scale(0.9);
  opacity:0;
  transition:all 1s cubic-bezier(0.34,1.56,0.64,1) 0.5s;
}
#qr img{
  width:100%;
  height:100%;
  display:block;
}

#telegramLink{
  font-size:16px;
  color:#8fefff;
  text-decoration:none;
  margin-bottom:25px;
  padding:12px 24px;
  background:rgba(0,40,80,0.6);
  border-radius:14px;
  border:1px solid rgba(143,239,255,0.3);
  backdrop-filter:blur(10px);
  transform:translateY(-100px);
  opacity:0;
  transition:all 1s cubic-bezier(0.34,1.56,0.64,1) 1s;
  text-align:center;
  width:100%;
  max-width:300px;
  box-sizing:border-box;
}
#telegramLink:active{
  background:rgba(0,60,120,0.7);
}

#finalWish{
  max-width:400px;
  font-size:15px;
  line-height:1.7;
  text-align:center;
  color:rgba(255,255,255,0.95);
  padding:20px;
  background:rgba(0,20,40,0.6);
  border-radius:18px;
  backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,0.05);
  transform:translateY(-150px);
  opacity:0;
  transition:all 1s cubic-bezier(0.34,1.56,0.64,1) 1.5s;
  width:100%;
  box-sizing:border-box;
}

/* –°–µ—Ä–¥–µ—á–∫–∏ */
#heartsCanvas{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index:55;
}

/* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ */
#restart{
  position:fixed;
  right:15px;
  bottom:15px;
  padding:12px 24px;
  border-radius:18px;
  border:none;
  background:rgba(255,255,255,0.15);
  color:#fff;
  font-size:14px;
  cursor:pointer;
  opacity:0;
  transition:all 0.4s ease;
  z-index:60;
  border:1px solid rgba(255,255,255,0.2);
  backdrop-filter:blur(10px);
  -webkit-appearance:none;
  touch-action:manipulation;
}
#restart:active{
  background:rgba(255,255,255,0.25);
  transform:scale(0.98);
}

/* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
  .scene {
    padding: 15px;
  }
  
  .card {
    height: min(70vh, 400px);
  }
  
  .side {
    padding: 20px;
    border-radius: 15px;
  }
  
  .card-content h1 {
    font-size: clamp(24px, 7vw, 36px);
  }
  
  .card-content p {
    font-size: clamp(14px, 4vw, 18px);
  }
  
  #telegramLink {
    font-size: 14px;
    padding: 10px 20px;
  }
  
  #finalWish {
    font-size: 14px;
    padding: 15px;
  }
  
  #qr {
    width: 180px;
    height: 180px;
  }
  
  #preloadProgress {
    bottom: 20px;
  }
}

@media (max-height: 600px) {
  .card {
    height: 80vh;
  }
  
  .card-content {
    margin-top: 20px;
  }
  
  .card-content h1 {
    margin-bottom: 10px;
  }
  
  #qr {
    width: 160px;
    height: 160px;
    margin-bottom: 15px;
  }
}
</style>
</head>

<body>

<canvas id="snow"></canvas>
<canvas id="heartsCanvas"></canvas>

<div id="tg">@Demidovvv124</div>

<div id="start">
  <div id="browserNote">
    <div style="font-size:18px;margin-bottom:8px;opacity:0.8;">üéÑ‚ú®</div>
    –î–ª—è –ª—É—á—à–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:<br>
    <b style="color:#00eaff">Safari –Ω–∞ iOS</b> –∏–ª–∏ <b style="color:#00eaff">Chrome</b><br><br>
    üéß –í–∫–ª—é—á–∏—Ç–µ –∑–≤—É–∫ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è
  </div>
  <button id="startBtn">‚ú® –û—Ç–∫—Ä—ã—Ç—å –≤–æ–ª—à–µ–±—Å—Ç–≤–æ ‚ú®</button>
  
  <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ -->
  <div id="preloadProgress">
    <div id="preloadStatus">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤–∏–¥–µ–æ...</div>
    <div class="progress-bar">
      <div class="progress-fill"></div>
    </div>
  </div>
</div>

<div class="scene" id="scene">
  <div class="card" id="card">
    <!-- –õ–∏—Ü–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ -->
    <div class="side front">
      <div class="garland-wrapper">
        <div class="garland">
          <span style="--i:0"></span><span style="--i:1"></span><span style="--i:2"></span>
          <span style="--i:3"></span><span style="--i:4"></span><span style="--i:5"></span>
          <span style="--i:6"></span><span style="--i:7"></span><span style="--i:8"></span>
          <span style="--i:9"></span><span style="--i:10"></span><span style="--i:11"></span>
        </div>
      </div>
      <div class="card-content">
        <h1 id="frontEmoji">üåü</h1>
        <p id="frontText"></p>
      </div>
    </div>
    
    <!-- –û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ -->
    <div class="side back">
      <div class="garland-wrapper">
        <div class="garland">
          <span style="--i:12"></span><span style="--i:13"></span><span style="--i:14"></span>
          <span style="--i:15"></span><span style="--i:16"></span><span style="--i:17"></span>
          <span style="--i:18"></span><span style="--i:19"></span><span style="--i:20"></span>
          <span style="--i:21"></span><span style="--i:22"></span><span style="--i:23"></span>
        </div>
      </div>
      <div class="card-content">
        <h1 id="backEmoji">üí´</h1>
        <p id="backText"></p>
      </div>
    </div>
  </div>
</div>

<div id="dark"></div>
<div id="finalText"></div>
<div id="whiteFlash"></div>

<video 
  id="cat" 
  playsinline 
  webkit-playsinline
  preload="auto"
  muted
  playsinline
  webkit-playsinline
  x5-playsinline
  t7-playsinline
  style="display:none;"
></video>

<div id="videoFade"></div>

<div id="finalScreen">
  <div class="final-effects"></div>
  <div id="qrContainer">
    <div id="qr">
      <img src="qr.png" alt="QR –∫–æ–¥ Telegram">
    </div>
    <a id="telegramLink" href="https://t.me/Byte_squade" target="_blank">
      ‚ú® t.me/Byte_squade ‚ú®
    </a>
    <div id="finalWish">
      –ü—É—Å—Ç—å –Ω–æ–≤—ã–π –≥–æ–¥ –ø—Ä–∏–Ω–µ—Å—ë—Ç –±–æ–ª—å—à–µ –∂–∏–≤—ã—Ö –≤—Å—Ç—Ä–µ—á<br>
      –∏ —Ç—ë–ø–ª—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤, –∏—Å–∫—Ä–µ–Ω–Ω–∏—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤<br>
      –∏ –≤–∑–∞–∏–º–æ–ø–æ–Ω–∏–º–∞–Ω–∏—è. –°—á–∞—Å—Ç–ª–∏–≤–æ–≥–æ –ù–æ–≤–æ–≥–æ 2026 –ì–æ–¥–∞! üéÑüåü
    </div>
  </div>
</div>

<button id="restart" onclick="location.reload()">üîÑ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞</button>

<audio id="music" src="zitronsound-christmas-village.mp3" loop></audio>

<script>
// ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
const CONFIG = {
  CARD_FLIP_TIME: 7000,
  FIRST_CARD_DELAY: 2000,
  FINAL_TEXT_DELAY: 1500,
  FLASH_DURATION: 3000,
  VIDEO_FADE_TIME: 9,
  FINAL_SCREEN_DELAY: 1000,
  MAX_HEARTS: 25,
  MAX_SNOWFLAKES: 80
};

// ========== –°–û–°–¢–û–Ø–ù–ò–ï ==========
let state = {
  videoLoaded: false,
  audioContext: null,
  flashSound: null,
  currentCard: 0,
  isCardFront: true,
  hearts: [],
  cardFlipTimeout: null,
  videoFadeStarted: false,
  musicPlaying: false,
  firstCardShown: false,
  isMobile: false,
  isIOS: false,
  preloadStarted: false,
  videoPreloaded: false
};

// ========== –≠–õ–ï–ú–ï–ù–¢–´ ==========
const elements = {
  start: document.getElementById('start'),
  startBtn: document.getElementById('startBtn'),
  scene: document.getElementById('scene'),
  card: document.getElementById('card'),
  frontEmoji: document.getElementById('frontEmoji'),
  frontText: document.getElementById('frontText'),
  backEmoji: document.getElementById('backEmoji'),
  backText: document.getElementById('backText'),
  dark: document.getElementById('dark'),
  finalText: document.getElementById('finalText'),
  whiteFlash: document.getElementById('whiteFlash'),
  cat: document.getElementById('cat'),
  videoFade: document.getElementById('videoFade'),
  finalScreen: document.getElementById('finalScreen'),
  qrContainer: document.getElementById('qrContainer'),
  qr: document.getElementById('qr'),
  telegramLink: document.getElementById('telegramLink'),
  finalWish: document.getElementById('finalWish'),
  restart: document.getElementById('restart'),
  music: document.getElementById('music'),
  snowCanvas: document.getElementById('snow'),
  heartsCanvas: document.getElementById('heartsCanvas'),
  preloadProgress: document.getElementById('preloadProgress'),
  preloadStatus: document.getElementById('preloadStatus'),
  progressFill: document.querySelector('.progress-fill')
};

// ========== –ü–ñ–ï–õ–ê–ù–ò–Ø ==========
const wishes = [
  { emoji: "üåü", text: "–ü—É—Å—Ç—å –ù–æ–≤—ã–π 2026 –≥–æ–¥ –ø—Ä–∏–Ω–µ—Å—ë—Ç –≤ –≤–∞—à—É –∂–∏–∑–Ω—å –±–æ–ª—å—à–µ —Å–≤–µ—Ç–∞, —Ç–µ–ø–ª–∞ –∏ —Ä–∞–¥–æ—Å—Ç–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π, –∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –±—É–¥–µ—Ç –Ω–∞–ø–æ–ª–Ω–µ–Ω —Å–º—ã—Å–ª–æ–º." },
  { emoji: "üí´", text: "–ñ–µ–ª–∞—é –∫—Ä–µ–ø–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è, –¥—É—à–µ–≤–Ω–æ–≥–æ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–º –¥–Ω–µ. –ü—É—Å—Ç—å –≤—Å–µ —Ä–µ—à–µ–Ω–∏—è –¥–∞—é—Ç—Å—è –ª–µ–≥–∫–æ." },
  { emoji: "ü§ç", text: "–ü—É—Å—Ç—å —Ä—è–¥–æ–º –≤—Å–µ–≥–¥–∞ –±—É–¥—É—Ç —Ç–µ, –∫—Ç–æ –ø–æ–Ω–∏–º–∞–µ—Ç –±–µ–∑ —Å–ª–æ–≤, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤ —Ç—Ä—É–¥–Ω—É—é –º–∏–Ω—É—Ç—É –∏ –∏—Å–∫—Ä–µ–Ω–Ω–µ —Ä–∞–¥—É–µ—Ç—Å—è –≤–∞—à–∏–º —É—Å–ø–µ—Ö–∞–º." },
  { emoji: "‚ú®", text: "–ò –ø—É—Å—Ç—å —ç—Ç–æ—Ç –≥–æ–¥ —Å—Ç–∞–Ω–µ—Ç –≤—Ä–µ–º–µ–Ω–µ–º —Ç—ë–ø–ª—ã—Ö –≤—Å—Ç—Ä–µ—á, –¥—É—à–µ–≤–Ω—ã—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ –∏ –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã—Ö –º–≥–Ω–æ–≤–µ–Ω–∏–π!" }
];

// ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ò–°–¢–ï–ú ==========
function initSystems() {
  initSnow();
  initHearts();
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
  state.isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
  state.isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
  
  // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É –≤–∏–¥–µ–æ —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  setTimeout(() => {
    startVideoPreload();
  }, 1000);
}

// ========== –°–ù–ï–ì ==========
function initSnow() {
  const canvas = elements.snowCanvas;
  const ctx = canvas.getContext('2d');
  
  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  
  let resizeTimeout;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(resize, 100);
  });
  
  const flakes = Array.from({ length: CONFIG.MAX_SNOWFLAKES }, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    r: Math.random() * 1.5 + 0.5,
    v: Math.random() * 0.4 + 0.1,
    o: Math.random() * 0.3 + 0.2,
    sway: Math.random() * 0.3
  }));
  
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    flakes.forEach(f => {
      ctx.beginPath();
      ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(255,255,255,${f.o})`;
      ctx.fill();
      
      f.y += f.v;
      f.x += Math.sin(f.y * 0.01) * f.sway;
      
      if (f.y > canvas.height) {
        f.y = -5;
        f.x = Math.random() * canvas.width;
      }
      if (f.x > canvas.width) f.x = 0;
      if (f.x < 0) f.x = canvas.width;
    });
    
    requestAnimationFrame(draw);
  }
  draw();
}

// ========== –°–ï–†–î–ï–ß–ö–ò ==========
function initHearts() {
  const canvas = elements.heartsCanvas;
  const ctx = canvas.getContext('2d');
  
  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  
  let resizeTimeout;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(resize, 100);
  });
  
  function spawnHeart() {
    if (state.hearts.length >= CONFIG.MAX_HEARTS) return;
    
    state.hearts.push({
      x: Math.random() * canvas.width,
      y: canvas.height + 20,
      size: Math.random() * 0.3 + 0.15,
      speed: Math.random() * 0.2 + 0.1,
      color: `hsl(${Math.random() * 360}, 100%, 65%)`,
      life: 1,
      rotation: Math.random() * Math.PI * 2,
      rotationSpeed: (Math.random() - 0.5) * 0.01
    });
  }
  
  function drawHeart(x, y, size, rotation, color) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(rotation);
    ctx.scale(size, size);
    
    ctx.beginPath();
    for (let a = 0; a < Math.PI * 2; a += 0.15) {
      const px = 16 * Math.pow(Math.sin(a), 3);
      const py = -(13 * Math.cos(a) - 5 * Math.cos(2*a) - 2 * Math.cos(3*a) - Math.cos(4*a));
      if (a === 0) ctx.moveTo(px, py);
      else ctx.lineTo(px, py);
    }
    ctx.closePath();
    ctx.fillStyle = color;
    ctx.fill();
    
    ctx.restore();
  }
  
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    state.hearts.forEach((h, i) => {
      h.y -= h.speed;
      h.life -= 0.0015;
      h.rotation += h.rotationSpeed;
      
      if (h.life <= 0 || h.y < -30) {
        state.hearts.splice(i, 1);
        return;
      }
      
      ctx.save();
      ctx.globalAlpha = h.life;
      ctx.shadowColor = h.color;
      ctx.shadowBlur = 10 * h.life;
      drawHeart(h.x, h.y, h.size * h.life, h.rotation, h.color);
      ctx.restore();
    });
    
    requestAnimationFrame(draw);
  }
  draw();
}

// ========== –ü–†–ï–î–ó–ê–ì–†–£–ó–ö–ê –í–ò–î–ï–û ==========
function startVideoPreload() {
  if (state.preloadStarted) return;
  state.preloadStarted = true;
  
  elements.preloadProgress.style.opacity = 1;
  elements.preloadStatus.textContent = "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤–∏–¥–µ–æ...";
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–∏–¥–µ–æ
  elements.cat.src = "cat.mp4";
  
  let lastTime = 0;
  let lastLoaded = 0;
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
  elements.cat.addEventListener('progress', () => {
    if (elements.cat.buffered.length > 0) {
      const bufferedEnd = elements.cat.buffered.end(elements.cat.buffered.length - 1);
      const duration = elements.cat.duration || 1;
      const progress = Math.min(bufferedEnd / duration, 1);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
      elements.progressFill.style.width = `${progress * 100}%`;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
      const percent = Math.round(progress * 100);
      if (percent % 10 === 0 && percent !== lastLoaded) {
        elements.preloadStatus.textContent = `–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ: ${percent}%`;
        lastLoaded = percent;
      }
    }
  });
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
  elements.cat.addEventListener('loadeddata', () => {
    elements.progressFill.style.width = '100%';
    elements.preloadStatus.textContent = "–í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ!";
    state.videoPreloaded = true;
    state.videoLoaded = true;
    
    // –ß–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É —Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
    setTimeout(() => {
      elements.preloadProgress.style.opacity = 0;
    }, 1000);
  });
  
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
  elements.cat.addEventListener('error', (e) => {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ:", e);
    elements.preloadStatus.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ";
    elements.progressFill.style.background = "#ff3366";
    
    // –í—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º, –Ω–æ –±–µ–∑ –≤–∏–¥–µ–æ
    setTimeout(() => {
      elements.preloadProgress.style.opacity = 0;
    }, 2000);
  });
  
  // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
  elements.cat.load();
  
  // –¢–∞–π–º–∞—É—Ç –Ω–∞ —Å–ª—É—á–∞–π –∑–∞–≤–∏—Å–∞–Ω–∏—è
  setTimeout(() => {
    if (!state.videoPreloaded) {
      elements.preloadStatus.textContent = "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É";
      elements.progressFill.style.width = '100%';
      elements.progressFill.style.background = "#ff9900";
      
      // –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞
      const skipBtn = document.createElement('button');
      skipBtn.textContent = "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å";
      skipBtn.style.cssText = `
        margin-top: 10px;
        padding: 8px 16px;
        background: rgba(255,255,255,0.2);
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 14px;
        cursor: pointer;
      `;
      skipBtn.onclick = () => {
        elements.preloadProgress.style.opacity = 0;
        skipBtn.remove();
      };
      elements.preloadProgress.appendChild(skipBtn);
    }
  }, 10000);
}

// ========== –ê–£–î–ò–û –°–ò–°–¢–ï–ú–ê ==========
async function initAudio() {
  try {
    if (state.audioContext) return true;
    
    state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
    if (state.audioContext.state === 'suspended') {
      await state.audioContext.resume();
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–≤—É–∫ —Ñ–ª–µ—à–∫–∏
    try {
      const response = await fetch("flash.mp3");
      const arrayBuffer = await response.arrayBuffer();
      state.flashSound = await state.audioContext.decodeAudioData(arrayBuffer);
    } catch (e) {
      console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–≤—É–∫ —Ñ–ª–µ—à–∫–∏");
    }
    
    return true;
  } catch (error) {
    console.warn("–ê—É–¥–∏–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–≤—É–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤");
    return false;
  }
}

// ========== –í–û–°–ü–†–û–ò–ó–í–ï–î–ï–ù–ò–ï –í–ò–î–ï–û ==========
async function playVideo() {
  if (!state.videoPreloaded) {
    // –ï—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–æ, –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é
    try {
      if (state.isMobile) {
        elements.cat.muted = true;
        elements.cat.volume = 0;
      } else {
        elements.cat.muted = false;
        elements.cat.volume = 1;
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç
      elements.cat.style.display = 'block';
      
      await elements.cat.play();
      elements.cat.classList.add('playing');
      
      // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –≤–∫–ª—é—á–∞–µ–º –∑–≤—É–∫ —á–µ—Ä–µ–∑ 500ms
      if (state.isMobile) {
        setTimeout(() => {
          try {
            elements.cat.muted = false;
            elements.cat.volume = 1;
          } catch (e) {
            console.log("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ –≤–∏–¥–µ–æ");
          }
        }, 500);
      }
      
      setupVideoFadeout();
      return true;
    } catch (error) {
      console.error("‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–µ–æ:", error);
      return false;
    }
  }
  
  try {
    // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –Ω–∞—á–∏–Ω–∞–µ–º —Å muted
    if (state.isMobile) {
      elements.cat.muted = true;
      elements.cat.volume = 0;
    } else {
      elements.cat.muted = false;
      elements.cat.volume = 1;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç
    elements.cat.style.display = 'block';
    
    // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å
    await elements.cat.play();
    
    elements.cat.classList.add('playing');
    
    // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –≤–∫–ª—é—á–∞–µ–º –∑–≤—É–∫ —á–µ—Ä–µ–∑ 500ms
    if (state.isMobile) {
      setTimeout(() => {
        try {
          elements.cat.muted = false;
          elements.cat.volume = 1;
        } catch (e) {
          console.log("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ –≤–∏–¥–µ–æ");
        }
      }, 500);
    }
    
    setupVideoFadeout();
    return true;
  } catch (error) {
    console.error("‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–µ–æ:", error);
    return false;
  }
}

function setupVideoFadeout() {
  let fadeCheckInterval;
  
  function checkFade() {
    if (!elements.cat.duration || state.videoFadeStarted || elements.cat.paused) return;
    
    const timeLeft = elements.cat.duration - elements.cat.currentTime;
    
    // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –∑–∞ VIDEO_FADE_TIME —Å–µ–∫—É–Ω–¥ –¥–æ –∫–æ–Ω—Ü–∞
    if (timeLeft <= CONFIG.VIDEO_FADE_TIME) {
      state.videoFadeStarted = true;
      const startTime = elements.cat.currentTime;
      
      function fadeVideo() {
        if (!elements.cat.duration || elements.cat.paused) return;
        
        const currentTime = elements.cat.currentTime;
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / CONFIG.VIDEO_FADE_TIME, 1);
        
        // –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
        elements.videoFade.style.opacity = progress;
        // –ü–ª–∞–≤–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –≤–∏–¥–µ–æ
        elements.cat.volume = Math.max(0, 1 - progress);
        
        if (progress < 1) {
          requestAnimationFrame(fadeVideo);
        }
      }
      
      requestAnimationFrame(fadeVideo);
    }
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 100ms
  fadeCheckInterval = setInterval(checkFade, 100);
  
  // –ö–æ–≥–¥–∞ –≤–∏–¥–µ–æ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è
  elements.cat.addEventListener('ended', () => {
    clearInterval(fadeCheckInterval);
    elements.videoFade.style.opacity = 1;
    elements.cat.style.opacity = 0;
    
    setTimeout(showFinalScreen, CONFIG.FINAL_SCREEN_DELAY);
  }, { once: true });
}

// ========== –ö–ê–†–¢–û–ß–ö–ò ==========
function updateCardText(isFront, wish) {
  if (isFront) {
    elements.frontEmoji.textContent = wish.emoji;
    elements.frontText.textContent = wish.text;
  } else {
    elements.backEmoji.textContent = wish.emoji;
    elements.backText.textContent = wish.text;
  }
}

function startCards() {
  state.currentCard = 0;
  state.firstCardShown = false;
  updateCardText(true, wishes[0]);
  state.isCardFront = true;
  
  // –ü–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–æ–ª—å—à–µ
  setTimeout(() => {
    state.firstCardShown = true;
    flipCard();
  }, CONFIG.FIRST_CARD_DELAY);
}

function flipCard() {
  state.currentCard++;
  
  if (state.currentCard >= wishes.length) {
    if (state.cardFlipTimeout) clearTimeout(state.cardFlipTimeout);
    setTimeout(showFinalTransition, 1000);
    return;
  }
  
  const nextIsFront = !state.isCardFront;
  updateCardText(nextIsFront, wishes[state.currentCard]);
  
  // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞
  if (state.isCardFront) {
    elements.card.style.transform = 'rotateY(180deg)';
  } else {
    elements.card.style.transform = 'rotateY(0deg)';
  }
  
  state.isCardFront = !state.isCardFront;
  
  if (state.cardFlipTimeout) clearTimeout(state.cardFlipTimeout);
  
  const delay = CONFIG.CARD_FLIP_TIME;
  state.cardFlipTimeout = setTimeout(flipCard, delay);
}

// ========== –í–°–ü–´–®–ö–ê ==========
async function playFlash() {
  // –ë–µ–ª–∞—è –≤—Å–ø—ã—à–∫–∞
  elements.whiteFlash.style.transition = 'opacity 0.05s ease-out';
  elements.whiteFlash.style.opacity = 1;
  
  // –ó–≤—É–∫ —Ñ–ª–µ—à–∫–∏
  if (state.audioContext && state.flashSound) {
    try {
      const source = state.audioContext.createBufferSource();
      const gainNode = state.audioContext.createGain();
      
      source.buffer = state.flashSound;
      source.connect(gainNode);
      gainNode.connect(state.audioContext.destination);
      
      gainNode.gain.value = 0;
      const now = state.audioContext.currentTime;
      gainNode.gain.setValueAtTime(0, now);
      gainNode.gain.linearRampToValueAtTime(0.8, now + 0.05);
      gainNode.gain.exponentialRampToValueAtTime(0.001, now + 3);
      
      source.start();
    } catch (error) {
      console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫ –≤—Å–ø—ã—à–∫–∏");
    }
  }
  
  // –ü–ª–∞–≤–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
  setTimeout(() => {
    elements.whiteFlash.style.transition = 'opacity 2.9s ease-out';
    elements.whiteFlash.style.opacity = 0;
  }, 100);
  
  // –ó–∞–ø—É—Å–∫ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ 500ms
  setTimeout(async () => {
    const success = await playVideo();
    if (!success) {
      // –ï—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —ç–∫—Ä–∞–Ω—É
      setTimeout(showFinalScreen, 2000);
    }
  }, 500);
}

// ========== –§–ò–ù–ê–õ–¨–ù–´–ô –≠–ö–†–ê–ù ==========
function showFinalScreen() {
  elements.finalScreen.style.opacity = 1;
  
  // –ü–æ–æ—á–µ—Ä–µ–¥–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞–º–∏
  setTimeout(() => {
    elements.qrContainer.style.opacity = 1;
  }, 300);
  
  setTimeout(() => {
    elements.qr.style.opacity = 1;
    elements.qr.style.transform = 'translateY(0) scale(1)';
  }, 800);
  
  setTimeout(() => {
    elements.telegramLink.style.opacity = 1;
    elements.telegramLink.style.transform = 'translateY(0)';
  }, 1300);
  
  setTimeout(() => {
    elements.finalWish.style.opacity = 1;
    elements.finalWish.style.transform = 'translateY(0)';
    
    // –°–µ—Ä–¥–µ—á–∫–∏
    const heartInterval = setInterval(() => {
      if (state.hearts.length < CONFIG.MAX_HEARTS) {
        state.hearts.push({
          x: Math.random() * elements.heartsCanvas.width,
          y: elements.heartsCanvas.height + 20,
          size: Math.random() * 0.3 + 0.15,
          speed: Math.random() * 0.2 + 0.1,
          color: `hsl(${Math.random() * 360}, 100%, 65%)`,
          life: 1,
          rotation: Math.random() * Math.PI * 2,
          rotationSpeed: (Math.random() - 0.5) * 0.01
        });
      }
    }, 300);
    
    // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
    setTimeout(() => {
      elements.restart.style.opacity = 1;
    }, 2000);
  }, 1800);
}

// ========== –§–ò–ù–ê–õ–¨–ù–´–ô –ü–ï–†–ï–•–û–î ==========
function showFinalTransition() {
  elements.dark.style.opacity = 1;
  
  setTimeout(() => {
    elements.finalText.textContent = "‚ú® –° –ù–û–í–´–ú 2026 –ì–û–î–û–ú ‚ú®";
    elements.finalText.style.opacity = 1;
    
    setTimeout(() => {
      elements.finalText.style.opacity = 0;
      elements.music.pause();
      playFlash();
    }, 2500);
  }, CONFIG.FINAL_TEXT_DELAY);
}

// ========== –°–¢–ê–†–¢ –û–¢–ö–†–´–¢–ö–ò ==========
elements.startBtn.addEventListener('click', async function() {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ
  await initAudio();
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏
  if (!state.videoPreloaded) {
    elements.preloadStatus.textContent = "–ó–∞–ø—É—Å–∫ –æ—Ç–∫—Ä—ã—Ç–∫–∏...";
  }
  
  try {
    // –ó–∞–ø—É—Å–∫ –º—É–∑—ã–∫–∏
    if (state.isMobile) {
      elements.music.muted = true;
      elements.music.volume = 0;
    } else {
      elements.music.muted = false;
      elements.music.volume = 0.6;
    }
    
    await elements.music.play();
    state.musicPlaying = true;
    
    // –í–∫–ª—é—á–∞–µ–º –∑–≤—É–∫ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
    if (state.isMobile) {
      setTimeout(() => {
        elements.music.muted = false;
        elements.music.volume = 0.6;
      }, 300);
    }
    
    // –ü–ª–∞–≤–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
    elements.start.style.opacity = 0;
    setTimeout(() => {
      elements.start.style.display = 'none';
      
      // –ü–æ–∫–∞–∑ –æ—Ç–∫—Ä—ã—Ç–∫–∏
      elements.scene.classList.add('active');
      setTimeout(startCards, 500);
      
    }, 600);
  } catch (error) {
    console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –º—É–∑—ã–∫—É, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –Ω–µ—ë");
    elements.start.style.display = 'none';
    elements.scene.classList.add('active');
    setTimeout(startCards, 500);
  }
});

// ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
window.addEventListener('load', () => {
  initSystems();
  
  // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –º—É–∑—ã–∫–∏
  elements.music.load();
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Å–∞–π–∑–∞
  let resizeTimeout;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
      elements.snowCanvas.width = window.innerWidth;
      elements.snowCanvas.height = window.innerHeight;
      elements.heartsCanvas.width = window.innerWidth;
      elements.heartsCanvas.height = window.innerHeight;
    }, 100);
  });
});
</script>
</body>
</html>
